<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, width=device-width, minimum-scale=1, maximum-scale=1" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />

    <title>Home</title>

    <!-- acex2b - add theme and app styles -->
    <link rel="stylesheet" href="../css/theme-0.3.0.css" />
	<link rel="stylesheet" href="../css/app.css" />
	

    <!-- acex2c - import sdk and app scripts -->
    <script src="../javascript/sdk/brightcove-app-cloud-0.3.0.js"></script>
    <script src="../javascript/simplegeo.context.jq.min.js"></script>
	  <script src="../javascript/app.js"></script>

    <script type="text/javascript">
	/* TODOs
	general look & feel
	replace spinner with cantina logo
	better notification of what's going on when a spinner is up
	resize image on orientation change
	image metadata overlay on tap
	prev/next navigation of images
	fill the gallery screen (get rid of extra space)
	center large image on detail
	fix scrolling problem
	spinner when loading an image for the detail page
	*/
	
      /* acex4d - add view script */
    $(bc).bind("init", function () {
		// TODO include full url for large image
		var template = '<div class="thumb" data-large="{{3}}" data-full="{{4}}" style="height:{{0}}px; width:{{1}}px; background-image: url(\'{{2}}\')"></div>';
		
		$('#detail').bind('swipe', function(evt) {
			// forward -> next image
			// background -> previous image
		});

		if (!bc.device.isNative()) {
			for(var i=0; i<20; i++)
				$('#photos').append(app.markup(template, [100, 100, '../images/photo.jpg']));
		}
		
		else {
			app.getPhotos(function(data) {
				var json = JSON.parse(data);
				var entries = json.feed.entry;
				var images = [];
				var i;
				
				var maxWidth=0, maxHeight=0;
				var minWidth=1000, minHeight=100;
				
				for(i=0; i<entries.length; i++) {
					var entry = entries[i];
					var image = entry['media$group'];
					var thumb = image['media$thumbnail'][0];
					
					maxWidth = Math.max(maxWidth, thumb.width);
					maxHeight = Math.max(maxHeight, thumb.height);
					minWidth = Math.min(minWidth, thumb.width);
					minHeight = Math.min(minHeight, thumb.height);
					images[images.length] = image;
				}
				
				var d = Math.min(minWidth, minHeight);
				
				for(i=0; i<images.length; i++) {
//				  console.log(d);
					var image = images[i];
					$('#photos').append(app.markup(template, [d, d, image['media$thumbnail'][0].url, image['media$thumbnail'][2].url, image['media$content'][0].url ]));
				}
				
				$('#photos .thumb').bind('tap', function(evt) {
					// TODO get the target and set the source
					var w = bc.ui.width(), h = bc.ui.height();
					$('#largeImage').attr('src', null);
					$('#largeImage').attr('src', $(evt.target).attr('data-full')).css('max-width', w).css('max-height', h);
					
					bc.ui.forwardPage('#detail');
				});
			});
		}
	});            
    </script>
  </head>

  <body>
<!--
    <header class="home">
      <img src="../images/bc-demo-logo.png" width="85%" alt="Brightcove App Cloud" />
    </header>
-->
	<div id="gallery" class="page">
        <div class="scroller">
            <div class="scroller-contents">
                <section id="photos">
				</section>
			</div>
		</div>
	</div>
	
	<div id="detail" class="page">
        <div class="scroller">
            <div class="scroller-contents">
                <section>
					<img id="largeImage" />
				</section>
			</div>
		</div>
	</div>
	
	<!--
      <h1>Welcome developers!</h1>
      <p>We encourage you to take apart this sample template and see how
      easy it is to use App Cloud!</p>
      <p>Be sure to check out the API docs included with this distribution.</p>
      <p><em>SDK Version: 0.3.0</em></p>
	-->
    </section>
  </body>

</html> 
